{% extends 'accounting/plans_base.html' %}
{% load hq_shared_tags %}
{% load crispy_forms_tags %}
{% load i18n %}

{% block js %}{{ block.super }}
    <script src="{% static 'accounting/js/stay-on-tab.js' %}"></script>
    <script src="{% static 'hqwebapp/js/lib/select2/select2.js' %}"></script>
    <script src="{% static 'accounting/ko/accounting.software_plan_version_handler.js' %}"></script>
{% endblock %}

{% block head %}{{ block.super }}
    <link href="{% static 'hqwebapp/js/lib/select2/select2.css' %}" rel="stylesheet"/>
{% endblock %}

{% block js-inline %}{{ block.super }}
    <script>
        var planVersionFormHandler = new SoftwarePlanVersionFormHandler(
            {{ plan_version_form.feature_rates_dict|JSON }},
            {{ plan_version_form.product_rates_dict|JSON }}
        );
        ko.applyBindings(planVersionFormHandler, $('#roles').get(0));
        planVersionFormHandler.init();

    </script>
{% endblock %}

{% block main_column %}
    <ul class="nav nav-tabs" id="user-settings-tabs">
        <li><a href="#plan_info" data-toggle="tab">{% trans "Plan Information" %}</a></li>
        <li><a href="#roles" data-toggle="tab">{% trans "Roles and Features" %}</a></li>
        <li><a href="#versions" data-toggle="tab">{% trans "Version Summary" %}</a></li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane" id="plan_info">
            {{ block.super }}
        </div>

        <div class="tab-pane" id="roles">
            {% crispy plan_version_form %}
        </div>

        <div class="tab-pane" id="versions">
            {% include 'accounting/version_summary_tab.html' %}
        </div>
    </div>

    <script type="text/html" id="feature-rate-form-template">
        <div class="well">
            <div class="pull-right">
                <button type="button" class="btn btn-danger" data-bind="event: {click: $parent.featureRates.removeRate}">
                    <i class="icon-remove"></i>
                </button>
            </div>
            {% crispy feature_rate_form %}
        </div>
    </script>

    <script type="text/html" id="product-rate-form-template">
        <div class="well">
            <div class="pull-right">
                <button type="button" class="btn btn-danger" data-bind="event: {click: $parent.productRates.removeRate}">
                    <i class="icon-remove"></i>
                </button>
            </div>
            {% crispy product_rate_form %}
        </div>
    </script>
{% endblock %}
